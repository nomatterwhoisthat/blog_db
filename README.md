# MyBlog
## Описание
   Приложение представляет собой платформу для ведения блогов, где пользователи имеют возможность создавать, редактировать и удалять свои записи, оставлять комментарии к блогам, отвечать на комментарии других пользователей, добавлять категории и фотографию к своим блогам при желании и искать блоги по названию категорий.
   Реализована гибкая система контроля доступа с использованием RBAC (role-based access control).Система поддерживает роли пользователей, такие как администратор и гость. Гость имеет возможность создавать, редактировать и удалять свои блоги, просматривать блоги других пользователей,писать комментарии и удалять только свои комментарии. Пользователь может прикреплять фотографии к своим блогам. Администратор же имеет более расширенные возможности такие как: возможность удалить любой блог и комментарий любого пользователя.


 ## Наименование
 **MyBlog**-это название отражает предназначение самой платформы и основной идеи сервиса: ведение собственного блога.

 ## Предметная область
 Приложение разработано для создания и управления блогами. Оно ориентировано на пользователей, желающих вести личные блоги или управлять тематическими статьями. Система поддерживает администрирование контента и ролей, а также обеспечивает классификацию блогов по категориям для лучшей организации и навигации. Осуществлена иерархия комментариев. Основные сущности системы включают блоги, комментарии, категории и пользователей.

 ## Данные
 ### Пользователь:
 * Имя (обязательное, уникальное)
 * Email (обязательное, уникальное)
 * Пароль (обязательное, захэшированное)
 * Роль (admin, guest, значение по умолчанию - guest)
Для регистрации заполняем все эти данные для создания аккаунта, а для входа в аккаунт нужно сделать авторизацию, где будем указывать наш email и пароль для входа.
После входа в аккаунт мы можем создавать, изменять, смотреть и удалять блоги.
### Блоги:
Для создания блога нам нужно указать:
 * Заголовок блога (обязательное, макс. 255 символов)
 * Содержимое блога (обязательное)
 * Категория блога (опционально)
 * Фотография блога (опционально)
Для удаления ,изменения и получения определенного блога достаточно ввести id блога.
Для прикрепления фото достаточно указать только id фото. Пользователь может прикреплять только те фотографии, которые загрузил сам. 
Можно сортировать блоги по размеру текста и количеству комментариев в нём.
К созданным блогам можно оставлять комментарии, удалять их и просматривать все комментарии под определенным блогом.
### Комментарии
Для создания комментария достаточно указать:
* id блога
* содержание самого комментария
* id родительского комментария(если хочешь оставить ответ на чей-то комментарий)
Для просмотра всех комментариев под блогом нужно указать id блога.
Для удаления комментария нужно указать id комментария.
Для модерации комментария нужно указать id комментария и поменять флаг модерации.
### Категории
Как было сказано ранее мы можем опционально указывать категории при создании блога, но кроме того мы можем сами дополнять категории и просматривать весь существующий уникальный список.
Имеется возможность поиска блогов по названию категория. Для этого нам нужно ввести название категории из списка категорий и мы получим все блоги, связанные с этим названием.

# Для каждого элемента данных - ограничения:
* Заголовок блога - максимум 255 символов
* Контент блога - минимум 1 символ и максимум 20000
* Название категории - максимум 100 символов
* Количество категорий, которые можно уазывать в блоге - не больше 5
* Количетсво фотографий, которые можно прикрепить - 1
* Изображения должны быть в формате .jpg и .png, если выбрать файлы другого формата, то будет выведена ошибка: "Failed to upload photo: An error occurred while uploading the photo."
* Электронная почта должна соответствовать формату email
* Содержимое комментария - минимум 1 символ
* Пароль - должен содержать минимум 6 символов, как минимум одну заглавную и прописную букву, иначе выводится: "Password must be at least 6 characters long and contain at least one digit and one uppercase letter."
* Имя пользователя должно быть уникальным, иначе выводится: "The name is taken. Choose the another one."
* email должен быть уникальным и валидным, иначе выводится сообщение: "Email already registered"

# Общие ограничения целостности
* Валидация данных
* Ограничения доступов для различных ролей

# Пользовательские роли
Внутри сервиса две роли:
* Guest: создание блогов, обновление и удаление своих записей, возможность просматривать все блоги, находить блог по id блога, оставлять и удалять комментарии,оставлять ответы на другие комментарии, просматривать промодерированные комментарии под определенным блогом (по id блога), получать блоги по названию категорий, дополнять список категорий и просматривать его, создание своего пользователя, получение пользователя по id и удаление своего пользователя, получать список отсортированных блогов по длине блога и количеству промодерированных комменатриев, загружать фотографии, просматривать фотографию по id фото, прикреплять фотографию к блогу(если блог без фото), создавать блог с фотографией, просматривать фотографию, которая прикреплена к блогу, просматривать список всех загруженных фотографий пользователем.
* Administrator: имеет более расширенные возможности, так как может удалить блог любого пользователя и удалить любой комментарий, модерировать комментарии, есть возможность просматривать всех пользователей и удалять их, поллучать список отсортированных блогов по количеству всех комментариев.
* Moderator: после отправки пользователем сообщения, просматривает его -> модерирует -> после положительной модерации комментарий становится доступным всем или же удаляется.

При сортировке блогов по количеству комментариев модератору и админу высвечиваются количество всех комментариев(промодерированные/непромодерированные), а гостю лишь количество промодерированных.

# API
REST API для управления данными (создание, редактирование, удаление) блогов, комментариев и категорий.
Swagger-документация API проекта находится по пути docs/, где описаны все доступные эндпоинты, возможные запросы, параметры и ответы для каждой операции.

# Технологии разработки
* **FastAPI** — создание API и маршрутизация.
* **SQLAlchemy** — ORM для работы с базой данных.
* **OAuth2** — управление аутентификацией пользователей.
* **Passlib** — хэширование паролей.
* **JWT (JSON Web Tokens)** — управление токенами аутентификации.
* **Docker** - средство контейнеризации и развёртывания приложения.
* **Pydantic** - для валидации данных и создания схем.
* **unnittest** - для написания тестов.
* **alembic** - для миграций.


# Схема баз данных

![image](https://github.com/user-attachments/assets/84bf9a97-1243-47d7-b490-65e7d5440029)




# Язык программировани
* Python 3.12.6

# СУБД
* PostgreSQL

# Тесты
Тесты находятся в папке test и для запуска нужно:
   ```bash
   export PYTHONPATH=.
   pytest
   ```
или:
   ```bash
   make tests
   ```

# Инструкция по запуску приложения

1. **Предварительно установите Docker** для вашей системы.

2. **Склонируйте репозиторий**:

   ```bash
   git clone <URL_репозитория>
   cd <название_папки_с_репозиторием>
   ```

3. **Создайте и активируйте виртуальное окружение**:

   - **Для Mac или Linux**:
     ```bash
     python3 -m venv env
     source env/bin/activate
     ```

   - **Для Windows**:
     ```bash
     python -m venv venv
     venv\Scripts\activate
     ```

4. **Соберите и запустите контейнеры**:

   ```bash
   make run-docker
   ```

5. **Примените миграции**:

   ```bash
   make run-migration
   ```

6. **Доступ к приложению**:

   После успешного выполнения миграций, приложение будет доступно по адресу: [http://localhost:8000](http://localhost:8000).

7. **Остановите контейнеры и удалите созданные образы**:

   ```bash
   make stop-docker


